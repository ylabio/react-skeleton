# React skeleton

Скелет frontend приложения на React.
Открытая структура кода для свободного изменения, отполированная под множество типовых задач.

[Документация](https://react-skeleton.ru)

## Новый проект

Новый проект создается форком или клонированием репозитория react-skeleton,
чтобы в дальнейшем свободно модифицировать код под особенности проекта. 

## Требования

- Node.js >= 18

## Установка

`npm install`

## Запуск для разработки

В режиме разработки (development)  приложение запускается командой:

`npm start`

Приложение по умолчанию доступно по адресу `http://localhost:8031`. Порт меняется в файле конфигурации `src/config.js` и может отличаться от указанного.

```javascript
let config = {
 dev: {
   port: 8031,
 },
 // ...
}
```

В режиме разработки используется локальный webpack http сервер для отслеживания изменения в коде и последующего “горячего” обновления приложения в браузера. 

## Сборка для продакшена

Для публикации проекта на сервере сначала выполняется сборка приложения командой:

`npm run build`

Собранные и минимизированные файлы приложения помещаются в папку `/dist/web`.  На http сервере директория `/dist/web` должны быть публичной. 
Основные файлы в ней - это `index.html` и `main.js` Ниже есть пример настройки сервера nginx. [README](dist/README.md)

## Сборка для SSR

SSR - это рендер приложения на стороне сервера, чтобы клиент по первому запросу получал готовый html с данными. В первую очередь для обработки поисковиками. В последнюю для сокращения времени первого отображения. 

Чтобы фронтенд приложение запускать на сервере, его нужно собрать специально для ssr командой:  

`npm run build:ssr`

Сборка для SSR не отменяет обычной сборки, так как сервер все равно должен отдавать фронтенд приложение клиенту. Поэтому можно воспользоваться командой сборки всего:

`npm run build:all`
 
В директории ./dist/node будут созданы файлы серверного приложения. Приложение на сервере можно запустить командой:

`node ./server.js`

В `server.js` подключаются собранные файлы из `./dist/node`.

Можно одной командой выполнить сборку всего и запуск приложения с ssr:

`npm run start:ssr`

Сборка и запуск SSR по умолчанию работает в режиме продакшена. Как именно устроен SSR подробно рассматривается в соответствующем разделе документации.

## Настройка

Параметры сборки определяются в файле `webpack.config.js`. По умолчанию учтены режимы разработки/продакшена, сборки для серверного рендера, импорта файлов с jsx, less, картинок, шрифтов, прокси для апи (обхода CORS).

Конфигурация самого приложения определяется в файле `src/config.js`. По умолчанию определены параметры АПИ, роутинга. Здесь же параметры сервера разработки и рендера. В config.js можно добавлять свои параметры приложения.

Кроме настройки приложения и его сборки для продакшена потребуется настроить http сервер. Рекомендуется использовать nginx.
Nginx должен отдавать статичные файлы из `./dist/web`, а если url не на существующий файл, то отдавать `./dist/web/index.html`.

Пример настройки nginx

```
server {
  listen 80;
  server_name react-skeleton.com;
  location / {
    root /home/user/react-skeleton/dist/web;
    try_files $uri /index.html;
  }
}
```

Если планируется использовать серверный рендер (SSR), то потребуется запустить приложение на node.js 
и проксировать запросы в серверное приложение.

Для оптимизации запросы на файлы-ресурсы (картинки, стили...) можно раздавать через nginx.

В nginx можно также настроить прокси к апи, если оно находится на другом хосте.

```
server {
  listen 80;
  server_name react-skeleton.com;
  client_max_body_size 10M;
  
  #  location /api/ {
  #     proxy_redirect off;
  #     proxy_set_header Host api.react-skeleton.com; 
  #     proxy_set_header X-Real-IP $remote_addr;
  #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  #     proxy_set_header X-Forwarded-Proto $scheme;
  #     proxy_set_header X-Frame-Options SAMEORIGIN;
  #     proxy_pass https://api.react-skeleton.com;
  #  }
    
  #  location ~ \.(js|css|png|pdf|svg|webp|ico|ttf) {
  #    root /var/www/newsite/dist/web/;
  #    try_files $uri $uri/ =404; 
  #  }

  location / {
    proxy_redirect off;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Frame-Options SAMEORIGIN;
    proxy_pass http://127.0.0.1:8132;
  }
}
```

Для постоянной работы приложения рендера воспользуетесь менеджером процессов pm2. 

`pm2 start process.json`

## Анализ размера сборки

`npm run build-analize`
